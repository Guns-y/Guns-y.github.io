<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>Elasticsearch | Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="Elasticsearch">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.3">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">John Doe</h5>
          <a href="mailto:1047629166@qq.com" title="1047629166@qq.com" class="mail">
            
              <span>1</span>
            
              <span>0</span>
            
              <span>4</span>
            
              <span>7</span>
            
              <span>6</span>
            
              <span>2</span>
            
              <span>9</span>
            
              <span>1</span>
            
              <span>6</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/codefine" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/custom"  >
                <i class="icon icon-lg icon-plus-square"></i>
                CUSTOM
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Elasticsearch</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">Elasticsearch</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-01-16T02:45:22.848Z" itemprop="datePublished" class="page-time">
  2019-01-16
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-ELasticseach/Elsearch"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Elasticsearch</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-01-16 10:45:22" datetime="2019-01-16T02:45:22.848Z"  itemprop="datePublished">2019-01-16</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h1 id="快速入门篇课程介绍"><a href="#快速入门篇课程介绍" class="headerlink" title="快速入门篇课程介绍"></a>快速入门篇课程介绍</h1><p>Elasticsearch，是目前行业中非常热门的一个技术。Elasticsearch是一种分布式的海量数据搜索与分析的技术，可以用于电商网站、门户网站、企业IT系统等各种场景下的搜索引擎，也可以用于对海量的数据进行近实时的数据分析。相较于Lucene来说，Elasticsearch天然的分布式特性，让其可以支持海量的、PB级的大数据搜索。相对于Spark Streaming、Storm等大数据实时计算引擎来说，Elasticsearch天生为分布式执行数据分析操作而生的架构，海量数据量级下的近实时（秒级）性能支持，以及无比强大的搜索和聚合分析的语法支持，让ES更加适合进行大数据场景下的数据分析应用。</p>
<p>Spark Streaming进行实时数据分析，有天然的无法全量多数据流join、内核shuffle过程大量基于磁盘落地等缺陷，导致其实时数据分析功能较差，实时数据分析性能也较差。Storm则作为实时计算引擎的鼻祖，由于其对SQL的支持很弱，导致其非常不适合进行实时数据分析，开发成本巨大。而Elasticsearch克服了上述大数据技术的缺点，更加适合进行大数据场景下的数据分析操作。</p>
<p>本课程深入浅出剖析了Elasticsearch的核心基础知识，带着大家一步一步，从快速入门，到理解Elasticsearch的工作原理、内核级原理，再到动手实战操作Elasticsearch的各种核心功能，到最后可以基于Java开发基本的搜索和分析应用程序。</p>
<p>课程特点如下：</p>
<p>1、基于Elasticsearch最新版本，5.2版本，进行课程的讲解，让大家学好技术后，绝对不会落伍。而市面上的书籍和视频，使用的Elasticsearch版本都非常陈旧，一般都是1.x，或者2.x，即使学了，也完全跟现在最新的版本无法兼容，无法让同学们学以致用。</p>
<p>2、大白话讲解各种复杂知识点，不用太官方和学术的语言照着ppt简单讲解，而是采用与朋友聊天式的方式，进行对话和讲解，尽量采用最通俗的语言来解释各种复杂的技术问题，还有底层原理。</p>
<p>3、课程知识体系设计的足够详细，将一门技术的各个知识点和技术点，全部包含在课程中，一点一点的细致剖析和展开讲解，绝不让大家遗漏任何有用的知识点，尽量做到，课程知识体系完整，系统化，有广度，而且也有深度。比如说本套课程中，既全面包括了从入门使用，到分布式文档系统操作，到搜索引擎操作，到索引管理，最后到Java API使用，这样完整的知识体系。同时还细致到包含很多独家的知识点，比如说Elasticsearch如何突破扩容瓶颈，search timeout机制，如何定位不合法的搜索，等等。</p>
<p>4、包含很多独家的核心知识点和技术，比如乐观锁并发控制，写一致性与quorum机制，bulk api底层性能优化，deep-paging性能问题，大数据量零停机重建索引，等等。</p>
<p>5、课程的原理性讲解足够深入，一直剖析到ES的内核层面，而且几乎所有原理知识点的讲解100%都使用现场一点一点手工画图的方式来剖析和讲解。比如ES容错机制，document数据路由，object类型底层结构，相关度评分TF/IDF算法，doc value，type底层数据结构，内核级数据写入流程，index segment、memory buffer、filesystem cache、flush、commit等内核级原理。</p>
<p>6、大量的上机动手实验，几乎所有功能都会带着大家上机动手实战操作，演练，掌握功能的使用。比如入门级的电商网站商品管理案例，基于版本号进行乐观锁并发控制的实验，mget+bulk批量处理的实验，scoll滚动搜索大量数据的实验，scoll+bulk+alias零停机重建索引的实验，基于Java开发的员工管理案例，等等。</p>
<p>本套课程学完以后能够达到的效果：</p>
<p>1、快速掌握Elasticsearch的各种使用，包括document管理，索引管理，搜索，聚合分析，等等。<br>2、细致掌握Elasticsearch的各种高级核心知识点，包括乐观锁并发控制，mget+bulk批处理，零停机场景下重建索引，dynamic mapping模板定制，分词器定制，等等。<br>3、深入理解Elasticsearch的各种核心原理，包括分布式架构原理，分布式文档系统原理，分布式搜索引擎原理，内核级原理。<br>4、快速掌握基于Java来开发Elasticsearch的简单应用程序，实现包括document增删改查，常见的搜索操作，常见的聚合分析操作。<br>5、基于上述4点的掌握，可以为更加进一步深入学习Elasticsearch这门技术打好基础。</p>
<p>《Elasticsearch顶尖高手系列课程：核心知识篇（下半季）》预告：</p>
<p>核心知识篇还会有下半季，会在这半季的基础上更加深入的去讲解Elasticsearch的核心知识，让大家一站式彻底掌握和精通ES的核心知识体系</p>
<p>1、深度探秘Elasticsearch的搜索功能，彻底讲解ES搜索相关的所有知识点，包括复杂多条件组合搜索，搜索权重控制，多域/跨域搜索，近似匹配搜索，search as you type，相关度评分彻底掌控，Stemmer，模糊匹配和自动纠错，等等。</p>
<p>2、彻底解析ES的数据聚合分析功能，包括基于时间跨度的聚合分析，聚合结果排序，近似聚合算法，doc value和fielddata大揭秘，等等。</p>
<p>3、深入讲解ES的数据建模，包括父子关系数据建模，嵌套关系数据建模，超大数据量场景下，搜索和分析应用的数据建模与设计原则，等等。</p>
<p>4、基于Java彻底玩转Elasticsearch，包括基于Java实现bulk，scoll，复杂搜索，复杂聚合，索引管理，等等。</p>
<p>5、项目实战：新闻门户网站的小型搜索引擎&amp;数据分析系统</p>
<h1 id="Elasticsearch的功能-特点-适用场景"><a href="#Elasticsearch的功能-特点-适用场景" class="headerlink" title="Elasticsearch的功能 特点 适用场景"></a>Elasticsearch的功能 特点 适用场景</h1><p>课程大纲</p>
<p>1、Elasticsearch的功能，干什么的<br>2、Elasticsearch的适用场景，能在什么地方发挥作用<br>3、Elasticsearch的特点，跟其他类似的东西不同的地方在哪里</p>
<hr>
<p>1、Elasticsearch的功能</p>
<p>（1）分布式的搜索引擎和数据分析引擎</p>
<p>搜索：百度，网站的站内搜索，IT系统的检索<br>数据分析：电商网站，最近7天牙膏这种商品销量排名前10的商家有哪些；新闻网站，最近1个月访问量排名前3的新闻版块是哪些<br>分布式，搜索，数据分析</p>
<p>（2）全文检索，结构化检索，数据分析</p>
<p>全文检索：我想搜索商品名称包含牙膏的商品，select * from products where product_name like “%牙膏%”<br>结构化检索：我想搜索商品分类为日化用品的商品都有哪些，select * from products where category_id=’日化用品’<br>部分匹配、自动完成、搜索纠错、搜索推荐<br>数据分析：我们分析每一个商品分类下有多少个商品，select category_id,count(*) from products group by category_id</p>
<p>（3）对海量数据进行近实时的处理</p>
<p>分布式：ES自动可以将海量数据分散到多台服务器上去存储和检索<br>海联数据的处理：分布式以后，就可以采用大量的服务器去存储和检索数据，自然而然就可以实现海量数据的处理了<br>近实时：检索个数据要花费1小时（这就不要近实时，离线批处理，batch-processing）；在秒级别对数据进行搜索和分析</p>
<p>跟分布式/海量数据相反的：lucene，单机应用，只能在单台服务器上使用，最多只能处理单台服务器可以处理的数据量</p>
<hr>
<p>2、Elasticsearch的适用场景</p>
<p>国外</p>
<p>（1）维基百科，类似百度百科，牙膏，牙膏的维基百科，全文检索，高亮，搜索推荐<br>（2）The Guardian（国外新闻网站），类似搜狐新闻，用户行为日志（点击，浏览，收藏，评论）+社交网络数据（对某某新闻的相关看法），数据分析，给到每篇新闻文章的作者，让他知道他的文章的公众反馈（好，坏，热门，垃圾，鄙视，崇拜）<br>（3）Stack Overflow（国外的程序异常讨论论坛），IT问题，程序的报错，提交上去，有人会跟你讨论和回答，全文检索，搜索相关问题和答案，程序报错了，就会将报错信息粘贴到里面去，搜索有没有对应的答案<br>（4）GitHub（开源代码管理），搜索上千亿行代码<br>（5）电商网站，检索商品<br>（6）日志数据分析，logstash采集日志，ES进行复杂的数据分析（ELK技术，elasticsearch+logstash+kibana）<br>（7）商品价格监控网站，用户设定某商品的价格阈值，当低于该阈值的时候，发送通知消息给用户，比如说订阅牙膏的监控，如果高露洁牙膏的家庭套装低于50块钱，就通知我，我就去买<br>（8）BI系统，商业智能，Business Intelligence。比如说有个大型商场集团，BI，分析一下某某区域最近3年的用户消费金额的趋势以及用户群体的组成构成，产出相关的数张报表，**区，最近3年，每年消费金额呈现100%的增长，而且用户群体85%是高级白领，开一个新商场。ES执行数据分析和挖掘，Kibana进行数据可视化</p>
<p>国内</p>
<p>（9）国内：站内搜索（电商，招聘，门户，等等），IT系统搜索（OA，CRM，ERP，等等），数据分析（ES热门的一个使用场景）</p>
<hr>
<p>3、Elasticsearch的特点</p>
<p>（1）可以作为一个大型分布式集群（数百台服务器）技术，处理PB级数据，服务大公司；也可以运行在单机上，服务小公司<br>（2）Elasticsearch不是什么新技术，主要是将全文检索、数据分析以及分布式技术，合并在了一起，才形成了独一无二的ES；lucene（全文检索），商用的数据分析软件（也是有的），分布式数据库（mycat）<br>（3）对用户而言，是开箱即用的，非常简单，作为中小型的应用，直接3分钟部署一下ES，就可以作为生产环境的系统来使用了，数据量不大，操作不是太复杂<br>（4）数据库的功能面对很多领域是不够用的（事务，还有各种联机事务型的操作）；特殊的功能，比如全文检索，同义词处理，相关度排名，复杂数据分析，海量数据的近实时处理；Elasticsearch作为传统数据库的一个补充，提供了数据库所不不能提供的很多功能</p>
<h1 id="手工画图剖析Elasticsearch核心概念：NRT、索引、分片、副本"><a href="#手工画图剖析Elasticsearch核心概念：NRT、索引、分片、副本" class="headerlink" title="手工画图剖析Elasticsearch核心概念：NRT、索引、分片、副本"></a>手工画图剖析Elasticsearch核心概念：NRT、索引、分片、副本</h1><p>课程大纲</p>
<p>1、lucene和elasticsearch的前世今生<br>2、elasticsearch的核心概念<br>3、elasticsearch核心概念 vs. 数据库核心概念</p>
<hr>
<p>1、lucene和elasticsearch的前世今生</p>
<p>lucene，最先进、功能最强大的搜索库，直接基于lucene开发，非常复杂，api复杂（实现一些简单的功能，写大量的java代码），需要深入理解原理（各种索引结构）</p>
<p>elasticsearch，基于lucene，隐藏复杂性，提供简单易用的restful api接口、java api接口（还有其他语言的api接口）<br>（1）分布式的文档存储引擎<br>（2）分布式的搜索引擎和分析引擎<br>（3）分布式，支持PB级数据</p>
<p>开箱即用，优秀的默认参数，不需要任何额外设置，完全开源</p>
<p>关于elasticsearch的一个传说，有一个程序员失业了，陪着自己老婆去英国伦敦学习厨师课程。程序员在失业期间想给老婆写一个菜谱搜索引擎，觉得lucene实在太复杂了，就开发了一个封装了lucene的开源项目，compass。后来程序员找到了工作，是做分布式的高性能项目的，觉得compass不够，就写了elasticsearch，让lucene变成分布式的系统。</p>
<hr>
<p>2、elasticsearch的核心概念</p>
<p>（1）Near Realtime（NRT）：近实时，两个意思，从写入数据到数据可以被搜索到有一个小延迟（大概1秒）；基于es执行搜索和分析可以达到秒级</p>
<p>（2）Cluster：集群，包含多个节点，每个节点属于哪个集群是通过一个配置（集群名称，默认是elasticsearch）来决定的，对于中小型应用来说，刚开始一个集群就一个节点很正常<br>（3）Node：节点，集群中的一个节点，节点也有一个名称（默认是随机分配的），节点名称很重要（在执行运维管理操作的时候），默认节点会去加入一个名称为“elasticsearch”的集群，如果直接启动一堆节点，那么它们会自动组成一个elasticsearch集群，当然一个节点也可以组成一个elasticsearch集群</p>
<p>（4）Document&amp;field：文档，es中的最小数据单元，一个document可以是一条客户数据，一条商品分类数据，一条订单数据，通常用JSON数据结构表示，每个index下的type中，都可以去存储多个document。一个document里面有多个field，每个field就是一个数据字段。</p>
<p>product document</p>
<p>{<br>  “product_id”: “1”,<br>  “product_name”: “高露洁牙膏”,<br>  “product_desc”: “高效美白”,<br>  “category_id”: “2”,<br>  “category_name”: “日化用品”<br>}</p>
<p>（5）Index：索引，包含一堆有相似结构的文档数据，比如可以有一个客户索引，商品分类索引，订单索引，索引有一个名称。一个index包含很多document，一个index就代表了一类类似的或者相同的document。比如说建立一个product index，商品索引，里面可能就存放了所有的商品数据，所有的商品document。<br>（6）Type：类型，每个索引里都可以有一个或多个type，type是index中的一个逻辑数据分类，一个type下的document，都有相同的field，比如博客系统，有一个索引，可以定义用户数据type，博客数据type，评论数据type。</p>
<p>商品index，里面存放了所有的商品数据，商品document</p>
<p>但是商品分很多种类，每个种类的document的field可能不太一样，比如说电器商品，可能还包含一些诸如售后时间范围这样的特殊field；生鲜商品，还包含一些诸如生鲜保质期之类的特殊field</p>
<p>type，日化商品type，电器商品type，生鲜商品type</p>
<p>日化商品type：product_id，product_name，product_desc，category_id，category_name<br>电器商品type：product_id，product_name，product_desc，category_id，category_name，service_period<br>生鲜商品type：product_id，product_name，product_desc，category_id，category_name，eat_period</p>
<p>每一个type里面，都会包含一堆document</p>
<p>{<br>  “product_id”: “2”,<br>  “product_name”: “长虹电视机”,<br>  “product_desc”: “4k高清”,<br>  “category_id”: “3”,<br>  “category_name”: “电器”,<br>  “service_period”: “1年”<br>}</p>
<p>{<br>  “product_id”: “3”,<br>  “product_name”: “基围虾”,<br>  “product_desc”: “纯天然，冰岛产”,<br>  “category_id”: “4”,<br>  “category_name”: “生鲜”,<br>  “eat_period”: “7天”<br>}</p>
<p>（7）shard：单台机器无法存储大量数据，es可以将一个索引中的数据切分为多个shard，分布在多台服务器上存储。有了shard就可以横向扩展，存储更多数据，让搜索和分析等操作分布到多台服务器上去执行，提升吞吐量和性能。每个shard都是一个lucene index。<br>（8）replica：任何一个服务器随时可能故障或宕机，此时shard可能就会丢失，因此可以为每个shard创建多个replica副本。replica可以在shard故障时提供备用服务，保证数据不丢失，多个replica还可以提升搜索操作的吞吐量和性能。primary shard（建立索引时一次设置，不能修改，默认5个），replica shard（随时修改数量，默认1个），默认每个索引10个shard，5个primary shard，5个replica shard，最小的高可用配置，是2台服务器。</p>
<hr>
<p>3、elasticsearch核心概念 vs. 数据库核心概念</p>
<p>Elasticsearch            数据库</p>
<hr>
<p>Document            行<br>Type                表<br>Index                库</p>
<h1 id="在windows上安装和启动Elasticseach"><a href="#在windows上安装和启动Elasticseach" class="headerlink" title="在windows上安装和启动Elasticseach"></a>在windows上安装和启动Elasticseach</h1><p>1、安装JDK，至少1.8.0_73以上版本，java -version<br>2、下载和解压缩Elasticsearch安装包，目录结构<br>3、启动Elasticsearch：bin\elasticsearch.bat，es本身特点之一就是开箱即用，如果是中小型应用，数据量少，操作不是很复杂，直接启动就可以用了</p>
<p>4、检查ES是否启动成功：<a href="http://localhost:9200/?pretty" target="_blank" rel="noopener">http://localhost:9200/?pretty</a></p>
<p>name: node名称<br>cluster_name: 集群名称（默认的集群名称就是elasticsearch）<br>version.number: 5.2.0，es版本号</p>
<p>{<br>  “name” : “4onsTYV”,<br>  “cluster_name” : “elasticsearch”,<br>  “cluster_uuid” : “nKZ9VK_vQdSQ1J0Dx9gx1Q”,<br>  “version” : {<br>    “number” : “5.2.0”,<br>    “build_hash” : “24e05b9”,<br>    “build_date” : “2017-01-24T19:52:35.800Z”,<br>    “build_snapshot” : false,<br>    “lucene_version” : “6.4.0”<br>  },<br>  “tagline” : “You Know, for Search”<br>}</p>
<p>5、修改集群名称：elasticsearch.yml<br>6、下载和解压缩Kibana安装包，使用里面的开发界面，去操作elasticsearch，作为我们学习es知识点的一个主要的界面入口<br>7、启动Kibana：bin\kibana.bat<br>8、进入Dev Tools界面<br>9、GET _cluster/health</p>
<h1 id="快速入门案例实战之电商网站商品管理：集群健康检查，文档CRUD"><a href="#快速入门案例实战之电商网站商品管理：集群健康检查，文档CRUD" class="headerlink" title="快速入门案例实战之电商网站商品管理：集群健康检查，文档CRUD"></a>快速入门案例实战之电商网站商品管理：集群健康检查，文档CRUD</h1><p>课程大纲</p>
<p>1、document数据格式<br>2、电商网站商品管理案例：背景介绍<br>3、简单的集群管理<br>4、商品的CRUD操作（document CRUD操作）</p>
<hr>
<p>1、document数据格式</p>
<p>面向文档的搜索分析引擎</p>
<p>（1）应用系统的数据结构都是面向对象的，复杂的<br>（2）对象数据存储到数据库中，只能拆解开来，变为扁平的多张表，每次查询的时候还得还原回对象格式，相当麻烦<br>（3）ES是面向文档的，文档中存储的数据结构，与面向对象的数据结构是一样的，基于这种文档数据结构，es可以提供复杂的索引，全文检索，分析聚合等功能<br>（4）es的document用json数据格式来表达</p>
<p>public class Employee {</p>
<p>  private String email;<br>  private String firstName;<br>  private String lastName;<br>  private EmployeeInfo info;<br>  private Date joinDate;</p>
</div>
<p>private class EmployeeInfo {</p>
<p>  private String bio; // 性格<br>  private Integer age;<br>  private String[] interests; // 兴趣爱好</p>
</div>
<p>EmployeeInfo info = new EmployeeInfo();<br>info.setBio(“curious and modest”);<br>info.setAge(30);<br>info.setInterests(new String[]{“bike”, “climb”});</p>
<p>Employee employee = new Employee();<br>employee.setEmail(“<a href="mailto:zhangsan@sina.com" target="_blank" rel="noopener">zhangsan@sina.com</a>“);<br>employee.setFirstName(“san”);<br>employee.setLastName(“zhang”);<br>employee.setInfo(info);<br>employee.setJoinDate(new Date());</p>
<p>employee对象：里面包含了Employee类自己的属性，还有一个EmployeeInfo对象</p>
<p>两张表：employee表，employee_info表，将employee对象的数据重新拆开来，变成Employee数据和EmployeeInfo数据<br>employee表：email，first_name，last_name，join_date，4个字段<br>employee_info表：bio，age，interests，3个字段；此外还有一个外键字段，比如employee_id，关联着employee表</p>
<p>{<br>    “email”:      “<a href="mailto:zhangsan@sina.com" target="_blank" rel="noopener">zhangsan@sina.com</a>“,<br>    “first_name”: “san”,<br>    “last_name”: “zhang”,<br>    “info”: {<br>        “bio”:         “curious and modest”,<br>        “age”:         30,<br>        “interests”: [ “bike”, “climb” ]<br>    },<br>    “join_date”: “2017/01/01”<br>}</p>
<p>我们就明白了es的document数据格式和数据库的关系型数据格式的区别</p>
<hr>
<p>2、电商网站商品管理案例背景介绍</p>
<p>有一个电商网站，需要为其基于ES构建一个后台系统，提供以下功能：</p>
<p>（1）对商品信息进行CRUD（增删改查）操作<br>（2）执行简单的结构化查询<br>（3）可以执行简单的全文检索，以及复杂的phrase（短语）检索<br>（4）对于全文检索的结果，可以进行高亮显示<br>（5）对数据进行简单的聚合分析</p>
<hr>
<p>3、简单的集群管理</p>
<p>（1）快速检查集群的健康状况</p>
<p>es提供了一套api，叫做cat api，可以查看es中各种各样的数据</p>
<p>GET /_cat/health?v</p>
<p>epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent<br>1488006741 15:12:21  elasticsearch yellow          1         1      1   1    0    0        1             0                  -                 50.0%</p>
<p>epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent<br>1488007113 15:18:33  elasticsearch green           2         2      2   1    0    0        0             0                  -                100.0%</p>
<p>epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent<br>1488007216 15:20:16  elasticsearch yellow          1         1      1   1    0    0        1             0                  -                 50.0%</p>
<p>如何快速了解集群的健康状况？green、yellow、red？</p>
<p>green：每个索引的primary shard和replica shard都是active状态的<br>yellow：每个索引的primary shard都是active状态的，但是部分replica shard不是active状态，处于不可用的状态<br>red：不是所有索引的primary shard都是active状态的，部分索引有数据丢失了</p>
<p>为什么现在会处于一个yellow状态？</p>
<p>我们现在就一个笔记本电脑，就启动了一个es进程，相当于就只有一个node。现在es中有一个index，就是kibana自己内置建立的index。由于默认的配置是给每个index分配5个primary shard和5个replica shard，而且primary shard和replica shard不能在同一台机器上（为了容错）。现在kibana自己建立的index是1个primary shard和1个replica shard。当前就一个node，所以只有1个primary shard被分配了和启动了，但是一个replica shard没有第二台机器去启动。</p>
<p>做一个小实验：此时只要启动第二个es进程，就会在es集群中有2个node，然后那1个replica shard就会自动分配过去，然后cluster status就会变成green状态。</p>
<p>（2）快速查看集群中有哪些索引</p>
<p>GET /_cat/indices?v</p>
<p>health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size<br>yellow open   .kibana rUm9n9wMRQCCrRDEhqneBg   1   1          1            0      3.1kb          3.1kb</p>
<p>（3）简单的索引操作</p>
<p>创建索引：PUT /test_index?pretty</p>
<p>health status index      uuid                   pri rep docs.count docs.deleted store.size pri.store.size<br>yellow open   test_index XmS9DTAtSkSZSwWhhGEKkQ   5   1          0            0       650b           650b<br>yellow open   .kibana    rUm9n9wMRQCCrRDEhqneBg   1   1          1            0      3.1kb          3.1kb</p>
<p>删除索引：DELETE /test_index?pretty</p>
<p>health status index   uuid                   pri rep docs.count docs.deleted store.size pri.store.size<br>yellow open   .kibana rUm9n9wMRQCCrRDEhqneBg   1   1          1            0      3.1kb          3.1kb</p>
<hr>
<p>4、商品的CRUD操作</p>
<p>（1）新增商品：新增文档，建立索引</p>
<p>PUT /index/type/id<br>{<br>  “json数据”<br>}</p>
<p>PUT /ecommerce/product/1<br>{<br>    “name” : “gaolujie yagao”,<br>    “desc” :  “gaoxiao meibai”,<br>    “price” :  30,<br>    “producer” :      “gaolujie producer”,<br>    “tags”: [ “meibai”, “fangzhu” ]<br>}</p>
<p>{<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “_version”: 1,<br>  “result”: “created”,<br>  “_shards”: {<br>    “total”: 2,<br>    “successful”: 1,<br>    “failed”: 0<br>  },<br>  “created”: true<br>}</p>
<p>PUT /ecommerce/product/2<br>{<br>    “name” : “jiajieshi yagao”,<br>    “desc” :  “youxiao fangzhu”,<br>    “price” :  25,<br>    “producer” :      “jiajieshi producer”,<br>    “tags”: [ “fangzhu” ]<br>}</p>
<p>PUT /ecommerce/product/3<br>{<br>    “name” : “zhonghua yagao”,<br>    “desc” :  “caoben zhiwu”,<br>    “price” :  40,<br>    “producer” :      “zhonghua producer”,<br>    “tags”: [ “qingxin” ]<br>}</p>
<p>es会自动建立index和type，不需要提前创建，而且es默认会对document每个field都建立倒排索引，让其可以被搜索</p>
<p>（2）查询商品：检索文档</p>
<p>GET /index/type/id<br>GET /ecommerce/product/1</p>
<p>{<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “_version”: 1,<br>  “found”: true,<br>  “_source”: {<br>    “name”: “gaolujie yagao”,<br>    “desc”: “gaoxiao meibai”,<br>    “price”: 30,<br>    “producer”: “gaolujie producer”,<br>    “tags”: [<br>      “meibai”,<br>      “fangzhu”<br>    ]<br>  }<br>}</p>
<p>（3）修改商品：替换文档</p>
<p>PUT /ecommerce/product/1<br>{<br>    “name” : “jiaqiangban gaolujie yagao”,<br>    “desc” :  “gaoxiao meibai”,<br>    “price” :  30,<br>    “producer” :      “gaolujie producer”,<br>    “tags”: [ “meibai”, “fangzhu” ]<br>}</p>
<p>{<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “_version”: 1,<br>  “result”: “created”,<br>  “_shards”: {<br>    “total”: 2,<br>    “successful”: 1,<br>    “failed”: 0<br>  },<br>  “created”: true<br>}</p>
<p>{<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “_version”: 2,<br>  “result”: “updated”,<br>  “_shards”: {<br>    “total”: 2,<br>    “successful”: 1,<br>    “failed”: 0<br>  },<br>  “created”: false<br>}</p>
<p>PUT /ecommerce/product/1<br>{<br>    “name” : “jiaqiangban gaolujie yagao”<br>}</p>
<p>替换方式有一个不好，即使必须带上所有的field，才能去进行信息的修改</p>
<p>（4）修改商品：更新文档</p>
<p>POST /ecommerce/product/1/_update<br>{<br>  “doc”: {<br>    “name”: “jiaqiangban gaolujie yagao”<br>  }<br>}</p>
<p>{<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “_version”: 8,<br>  “result”: “updated”,<br>  “_shards”: {<br>    “total”: 2,<br>    “successful”: 1,<br>    “failed”: 0<br>  }<br>}</p>
<p>我的风格，其实有选择的情况下，不太喜欢念ppt，或者照着文档做，或者直接粘贴写好的代码，尽量是纯手敲代码</p>
<p>（5）删除商品：删除文档</p>
<p>DELETE /ecommerce/product/1</p>
<p>{<br>  “found”: true,<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “_version”: 9,<br>  “result”: “deleted”,<br>  “_shards”: {<br>    “total”: 2,<br>    “successful”: 1,<br>    “failed”: 0<br>  }<br>}</p>
<p>{<br>  “_index”: “ecommerce”,<br>  “_type”: “product”,<br>  “_id”: “1”,<br>  “found”: false<br>}</p>
<h1 id="快速入门案例实战之电商网站商品管理：多种搜索方式"><a href="#快速入门案例实战之电商网站商品管理：多种搜索方式" class="headerlink" title="快速入门案例实战之电商网站商品管理：多种搜索方式"></a>快速入门案例实战之电商网站商品管理：多种搜索方式</h1>
        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2019-06-19T13:08:23.077Z" itemprop="dateUpdated">2019-06-19 21:08:23</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/01/16/ELasticseach/Elsearch/" target="_blank" rel="external">http://yoursite.com/2019/01/16/ELasticseach/Elsearch/</a>
        
    </div>
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="John Doe">
            John Doe
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Elasticsearch/">Elasticsearch</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2019/01/16/ELasticseach/Elsearch/&title=《Elasticsearch》 — Hexo&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2019/01/16/ELasticseach/Elsearch/&title=《Elasticsearch》 — Hexo&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/01/16/Redis/Redis/Redis 尚硅谷/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Redis 尚硅谷</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/01/01/Spring/Spring IOC详解/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Spring IOC详解</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#快速入门篇课程介绍"><span class="post-toc-number">1.</span> <span class="post-toc-text">快速入门篇课程介绍</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Elasticsearch的功能-特点-适用场景"><span class="post-toc-number">2.</span> <span class="post-toc-text">Elasticsearch的功能 特点 适用场景</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#手工画图剖析Elasticsearch核心概念：NRT、索引、分片、副本"><span class="post-toc-number">3.</span> <span class="post-toc-text">手工画图剖析Elasticsearch核心概念：NRT、索引、分片、副本</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#在windows上安装和启动Elasticseach"><span class="post-toc-number">4.</span> <span class="post-toc-text">在windows上安装和启动Elasticseach</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#快速入门案例实战之电商网站商品管理：集群健康检查，文档CRUD"><span class="post-toc-number">5.</span> <span class="post-toc-text">快速入门案例实战之电商网站商品管理：集群健康检查，文档CRUD</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#快速入门案例实战之电商网站商品管理：多种搜索方式"><span class="post-toc-number">6.</span> <span class="post-toc-text">快速入门案例实战之电商网站商品管理：多种搜索方式</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们一起来让这个世界有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.lujingtao.com" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                John Doe &copy; 2017 - 2019
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2019/01/16/ELasticseach/Elsearch/&title=《Elasticsearch》 — Hexo&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2019/01/16/ELasticseach/Elsearch/&title=《Elasticsearch》 — Hexo&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACN0lEQVR42u3ay47CMAwFUP7/pzvSrJAQ4druPJqerFApTU4XJrbzeMTj+B7rK8/Xn789Xsa7+9/dc9rAwMC4LONYjvVSkt+u53p9Kc3nY2Bg3ICxDrLJ52ogTp6QrA0DAwMj2fAlwbEajjEwMDDmjF64XCeoGBgYGGtGksTmxbg8BP9BLo6BgXFBRrUx8Juff7C/gYGBcRHG0RpJWOyF3WYyjIGBsTWjt6A8fe21PPMrj+r0GBgYF2T0ks9zG5DJRvBD4Q8DA2NrRnIYIr+nepgsD+KFBgMGBsamjGpqOmkS9BqW6z8DDAyM+zCSh/aKZXlqWm1hYmBg3IfR6wz2Jq6G4KQIiIGBcQdGnl5WQ96k3JY3UDEwMO7DyEtgk+mrTcr8OgYGxt6MpE3Ym7IadnuJMQYGxt6MPB3Nk955Ulp+ZRgYGFszolMYg41afiyj+iqjohsGBsYWjOoWcL7VS1qk5VIdBgbG1owkvOaNgWqroNfabB6zwMDAuCyjegBrVM8rpr4YGBgY1Qkmm7x5WB+dccPAwLg4o5fE9kp1vTAdJboYGBhbM6ptxer0SQOguon88CsMDIztGEdxJFu6PDj2EuO3Z0YwMDA2ZeQjD8HJcifpcbWch4GBsQdj0p7sLS4/NFZIqjEwMG7AmBzzypGT7V2hH4uBgYFRLLf17klezQkBFwMDYzvGT+zEJq1TDAyMuzF6SWwvNOeMQnMUAwNja8YkKOeFs2pZLXlNJ/Q3MDAw/jvjCwQ960FFYdNHAAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.3"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.3"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.3"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.3"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.3"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>







    
</body>
</html>
