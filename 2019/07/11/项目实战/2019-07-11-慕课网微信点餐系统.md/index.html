<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>微信点餐系统 | Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="SpringBoot,项目">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.3">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	true,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">John Doe</h5>
          <a href="mailto:1047629166@qq.com" title="1047629166@qq.com" class="mail">
            
              <span>1</span>
            
              <span>0</span>
            
              <span>4</span>
            
              <span>7</span>
            
              <span>6</span>
            
              <span>2</span>
            
              <span>9</span>
            
              <span>1</span>
            
              <span>6</span>
            
              <span>6</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/codefine" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                HOME
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                CATEGORIES
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                TAGS
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                ARCHIVES
              </a>
            </li>
        
            <li class="">
              <a href="/custom"  >
                <i class="icon icon-lg icon-plus-square"></i>
                CUSTOM
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>微信点餐系统</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">微信点餐系统</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-07-11T09:26:55.375Z" itemprop="datePublished" class="page-time">
  2019-07-11
</time>


            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-项目实战/2019-07-11-慕课网微信点餐系统.md"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">微信点餐系统</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-07-11 17:26:55" datetime="2019-07-11T09:26:55.375Z"  itemprop="datePublished">2019-07-11</time>

            


            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h1 id="一-表结构"><a href="#一-表结构" class="headerlink" title="一 表结构"></a>一 表结构</h1><figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-11-131429.png" title="image-20190711211421327" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-11-131429.png" alt="image-20190711211421327" title class></a>
                <p>image-20190711211421327</p>
            </figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">-- 类目</span><br><span class="line">create table `product_category` (</span><br><span class="line">    `category_id` int not null auto_increment,</span><br><span class="line">    `category_name` varchar(64) not null comment &apos;类目名字&apos;,</span><br><span class="line">    `category_type` int not null comment &apos;类目编号&apos;,</span><br><span class="line">    `create_time` timestamp not null default current_timestamp comment &apos;创建时间&apos;,</span><br><span class="line">    `update_time` timestamp not null default current_timestamp on update current_timestamp comment &apos;修改时间&apos;,</span><br><span class="line">    primary key (`category_id`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 商品</span><br><span class="line">create table `product_info` (</span><br><span class="line">    `product_id` varchar(32) not null,</span><br><span class="line">    `product_name` varchar(64) not null comment &apos;商品名称&apos;,</span><br><span class="line">    `product_price` decimal(8,2) not null comment &apos;单价&apos;,</span><br><span class="line">    `product_stock` int not null comment &apos;库存&apos;,</span><br><span class="line">    `product_description` varchar(64) comment &apos;描述&apos;,</span><br><span class="line">    `product_icon` varchar(512) comment &apos;小图&apos;,</span><br><span class="line">    `product_status` tinyint(3) DEFAULT &apos;0&apos; COMMENT &apos;商品状态,0正常1下架&apos;,</span><br><span class="line">    `category_type` int not null comment &apos;类目编号&apos;,</span><br><span class="line">    `create_time` timestamp not null default current_timestamp comment &apos;创建时间&apos;,</span><br><span class="line">    `update_time` timestamp not null default current_timestamp on update current_timestamp comment &apos;修改时间&apos;,</span><br><span class="line">    primary key (`product_id`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 订单</span><br><span class="line">create table `order_master` (</span><br><span class="line">    `order_id` varchar(32) not null,</span><br><span class="line">    `buyer_name` varchar(32) not null comment &apos;买家名字&apos;,</span><br><span class="line">    `buyer_phone` varchar(32) not null comment &apos;买家电话&apos;,</span><br><span class="line">    `buyer_address` varchar(128) not null comment &apos;买家地址&apos;,</span><br><span class="line">    `buyer_openid` varchar(64) not null comment &apos;买家微信openid&apos;,</span><br><span class="line">    `order_amount` decimal(8,2) not null comment &apos;订单总金额&apos;,</span><br><span class="line">    `order_status` tinyint(3) not null default &apos;0&apos; comment &apos;订单状态, 默认为新下单&apos;,</span><br><span class="line">    `pay_status` tinyint(3) not null default &apos;0&apos; comment &apos;支付状态, 默认未支付&apos;,</span><br><span class="line">    `create_time` timestamp not null default current_timestamp comment &apos;创建时间&apos;,</span><br><span class="line">    `update_time` timestamp not null default current_timestamp on update current_timestamp comment &apos;修改时间&apos;,</span><br><span class="line">    primary key (`order_id`),</span><br><span class="line">    key `idx_buyer_openid` (`buyer_openid`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 订单商品</span><br><span class="line">create table `order_detail` (</span><br><span class="line">    `detail_id` varchar(32) not null,</span><br><span class="line">    `order_id` varchar(32) not null,</span><br><span class="line">    `product_id` varchar(32) not null,</span><br><span class="line">    `product_name` varchar(64) not null comment &apos;商品名称&apos;,</span><br><span class="line">    `product_price` decimal(8,2) not null comment &apos;当前价格,单位分&apos;,</span><br><span class="line">    `product_quantity` int not null comment &apos;数量&apos;,</span><br><span class="line">    `product_icon` varchar(512) comment &apos;小图&apos;,</span><br><span class="line">    `create_time` timestamp not null default current_timestamp comment &apos;创建时间&apos;,</span><br><span class="line">    `update_time` timestamp not null default current_timestamp on update current_timestamp comment &apos;修改时间&apos;,</span><br><span class="line">    primary key (`detail_id`),</span><br><span class="line">    key `idx_order_id` (`order_id`)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">-- 卖家(登录后台使用, 卖家登录之后可能直接采用微信扫码登录，不使用账号密码)</span><br><span class="line">create table `seller_info` (</span><br><span class="line">    `id` varchar(32) not null,</span><br><span class="line">    `username` varchar(32) not null,</span><br><span class="line">    `password` varchar(32) not null,</span><br><span class="line">    `openid` varchar(64) not null comment &apos;微信openid&apos;,</span><br><span class="line">    `create_time` timestamp not null default current_timestamp comment &apos;创建时间&apos;,</span><br><span class="line">    `update_time` timestamp not null default current_timestamp on update current_timestamp comment &apos;修改时间&apos;,</span><br><span class="line">    primary key (`id`)</span><br><span class="line">) comment &apos;卖家信息表&apos;;</span><br></pre></td></tr></table></figure>

<h1 id="二-VM"><a href="#二-VM" class="headerlink" title="二 VM"></a>二 VM</h1><blockquote>
<p>MyPassword centos7 +VirtualBox导入</p>
</blockquote>
<h1 id="三-日志"><a href="#三-日志" class="headerlink" title="三 日志"></a>三 日志</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = <span class="keyword">new</span> LoggerFactory.getlogger(DemoApplicationTests.class);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"info"</span>);</span><br><span class="line">        logger.debug(<span class="string">"debug"</span>);</span><br><span class="line">        logger.error(<span class="string">"error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用  slf4J 简化方法</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String name = <span class="string">"imooc"</span>;</span><br><span class="line">        String password = <span class="string">"123456"</span>;</span><br><span class="line">        log.info(<span class="string">"info"</span>);</span><br><span class="line">        log.debug(<span class="string">"debug"</span>);</span><br><span class="line">        log.error(<span class="string">"error"</span>);</span><br><span class="line">        log.info(<span class="string">"name: &#123;&#125;,password: &#123;&#125;"</span>, name, password);</span><br><span class="line">        <span class="comment">//log.error("n:&#123;&#125;,a:&#123;&#125;", n, a);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># application.yml. 不常用</span><br><span class="line">logging:</span><br><span class="line">  pattern:</span><br><span class="line">    console: &quot;%d -%msg%n&quot; # 设置日志格式</span><br><span class="line">  path: /var/log/tomcat/  #设置日期存储地址</span><br><span class="line">  file: /var/log/tomcat/sell.log</span><br><span class="line">  level: debug  #默认info</span><br></pre></td></tr></table></figure>

<hr>
<h5 id="logback-spring-xml"><a href="#logback-spring-xml" class="headerlink" title="logback-spring.xml"></a>logback-spring.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"consoleLog"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %d - %msg%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"fileInfoLog"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.LevelFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %msg%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ن؛م�ه­ه�--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--و��م�--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>/var/log/tomcat/sell/info.%d.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"fileErrorLog"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                %msg%n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ن؛م�ه­ه�--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--و��م�--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>/var/log/tomcat/sell/error.%d.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"info"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"consoleLog"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"fileInfoLog"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"fileErrorLog"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>#第4章 买家端类目</p>
<p>买家端类目模块的开发，按照dao-&gt;service-&gt;api的顺序开发。贯穿单元测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@DynamicUpdate</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductCategory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ه�؛ه�id. */</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>（strategy=GenerationType.IDENTITY）</span><br><span class="line">    <span class="keyword">private</span> Integer categoryId;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@DynamicUpdate 动态的更新时间</p>
</li>
<li><p>Springboot-jpa Table ‘sell.hibernate_sequence’ doesn’t exist</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span class="line">    url: jdbc:mysql://192.168.1.105/sell?characterEncoding=utf-8&amp;useSSL=false</span><br><span class="line">  jpa:</span><br><span class="line">    show-sql: true</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 mysql地址 写VM虚拟机里面的。密码也要是Linux的</span><br><span class="line">2 com.mysql.cj.jdbc.Driver CJ</span><br><span class="line">3 lombok</span><br><span class="line">mysql数据库驱动不要</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDao</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Optional&lt;ProductCategory&gt; one = productCategoryRepository.findById(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (one.isPresent()) &#123;</span><br><span class="line">            ProductCategory productCategor = one.get();</span><br><span class="line">            System.out.println(<span class="string">"======～～～====+～～～～=---===--=="</span>);</span><br><span class="line">            System.out.println(productCategor.toString());</span><br><span class="line">            System.out.println(<span class="string">"======～～～====+～～～～=---===--=="</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//保存Test 不要设置主键  主键自增长啦</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ProductCategory productCategory = <span class="keyword">new</span> ProductCategory();</span><br><span class="line">        productCategory.setCategoryName(<span class="string">"biaze"</span>);</span><br><span class="line">        productCategory.setCategoryType(<span class="number">2</span>);</span><br><span class="line">        productCategoryRepository.save(productCategory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新的话要设置主键 根据主键设置更新</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUpdateTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ProductCategory productCategory = <span class="keyword">new</span> ProductCategory();</span><br><span class="line">        productCategory.setCategoryId(<span class="number">3</span>);</span><br><span class="line">        productCategory.setCategoryName(<span class="string">"biaze2"</span>);</span><br><span class="line">        productCategory.setCategoryType(<span class="number">2</span>);</span><br><span class="line">        productCategoryRepository.save(productCategory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-12-123058.png" title="image-20190712203056683" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-12-123058.png" alt="image-20190712203056683" title class></a>
                <p>image-20190712203056683</p>
            </figure>

<p>生成serviceTest的方法</p>
<ul>
<li><p>Bug</p>
<p><a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002600.png" title="image-20190713082558460" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002600.png" alt="image-20190713082558460"></a></p>
</li>
</ul>
<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002619.png" title="image-20190713082617300" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002619.png" alt="image-20190713082617300" title class></a>
                <p>image-20190713082617300</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002634.png" title="image-20190713082632357" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002634.png" alt="image-20190713082632357" title class></a>
                <p>image-20190713082632357</p>
            </figure>

<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002653.png" title="image-20190713082649981" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002653.png" alt="image-20190713082649981" title class></a>
                <p>image-20190713082649981</p>
            </figure>

<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002732.png" title="image-20190713082730063" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-13-002732.png" alt="image-20190713082730063" title class></a>
                <p>image-20190713082730063</p>
            </figure>

<hr>
<h1 id="第五章-买家商品"><a href="#第五章-买家商品" class="headerlink" title="第五章 买家商品"></a>第五章 买家商品</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.json.UTF8JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.util.BeanUtil;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.VO.ProductInfoVo;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.VO.ProductVo;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.VO.ResultVo;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.dataobject.ProductCategory;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.dataobject.ProductInfo;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.repository.ProductInfoRepository;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.service.CategoryServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.service.ProductServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.imooc.demo.util.ResultVoUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/buyer/product"</span>)</span><br><span class="line"><span class="comment">//http://localhost:8080/sell/buyer/product/list</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyerProductController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CategoryServiceImpl categoryService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductServiceImpl productService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVo <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;ProductInfo&gt; productInfoList = productService.findUpAll();</span><br><span class="line">        <span class="comment">// categoryList存放商品的categoryType（product_info）</span></span><br><span class="line">        List&lt;Integer&gt; categoryList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ProductInfo productInfo : productInfoList) &#123;</span><br><span class="line">            Integer categoryType = productInfo.getCategoryType();</span><br><span class="line">            categoryList.add(categoryType);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//根据categoryType查询商品种类(product_category)</span></span><br><span class="line">        List&lt;ProductCategory&gt; productCategoryList = categoryService.findByCategoryTypeIn(categoryList);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 数据封装</span></span><br><span class="line"><span class="comment">         * ResultVo.set(ProductVo).set(ProductInfoVo)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        List&lt;ProductVo&gt; productVoList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (ProductCategory productCategory : productCategoryList) &#123;</span><br><span class="line">            ProductVo productVo = <span class="keyword">new</span> ProductVo();</span><br><span class="line">            productVo.setCategoryName(productCategory.getCategoryName());</span><br><span class="line">            productVo.setCategorytype(productCategory.getCategoryType());</span><br><span class="line">            <span class="comment">//------------------------⭐️⭐️------⭐️⭐⭐️⭐-------------⭐️⭐⭐️⭐-------------------------------------------------</span></span><br><span class="line">            List&lt;ProductInfoVo&gt; productInfoList1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (ProductInfo newProductInfo : productInfoList) &#123;</span><br><span class="line">                <span class="keyword">if</span> (newProductInfo.getCategoryType().equals(productCategory.getCategoryType())) &#123;</span><br><span class="line">                    ProductInfoVo productInfoVo = <span class="keyword">new</span> ProductInfoVo();</span><br><span class="line">                    <span class="comment">//  BeanUtils.copyProperties(productInfoList, productInfoVo);</span></span><br><span class="line">                    BeanUtils.copyProperties(newProductInfo, productInfoVo);</span><br><span class="line">                    productInfoList1.add(productInfoVo);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//----------------------⭐️⭐---------⭐️⭐⭐️⭐----------⭐️⭐⭐️⭐---------------------------------------------------</span></span><br><span class="line">            productVo.setProductInfoVoList(productInfoList1);</span><br><span class="line">            productVoList.add(productVo);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//1          ResultVo result = new ResultVo();</span></span><br><span class="line"><span class="comment">//        result.setMsg("成功");</span></span><br><span class="line"><span class="comment">//        result.setCode(0);</span></span><br><span class="line"><span class="comment">//        result.setData(productVoList);</span></span><br><span class="line">        <span class="comment">//2   return new ResultVoUtil();</span></span><br><span class="line">        <span class="keyword">return</span> ResultVoUtil.success(productVoList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035503.png" title="image-20190714115459817" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035503.png" alt="image-20190714115459817"></a></p>
<hr>
<ul>
<li><p>前端接口</p>
<p><a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035626.png" title="image-20190714115618966" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035626.png" alt="image-20190714115618966"></a></p>
</li>
</ul>
<hr>
<p>查询ip地址的ip地址</p>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035711.png" title="image-20190714115709618" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035711.png" alt="image-20190714115709618" title class></a>
                <p>image-20190714115709618</p>
            </figure>

<p>更改nginx.conf配置成本地ip地址</p>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035802.png" title="image-20190714115800928" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-035802.png" alt="image-20190714115800928" title class></a>
                <p>image-20190714115800928</p>
            </figure>

<hr>
<p>设置域名</p>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-040244.png" title="image-20190714120243104" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-040244.png" alt="image-20190714120243104" title class></a>
                <p>image-20190714120243104</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-040349.png" title="image-20190714120346634" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-040349.png" alt="image-20190714120346634" title class></a>
                <p>image-20190714120346634</p>
            </figure>

<hr>
<h1 id="第六章-买家订单"><a href="#第六章-买家订单" class="headerlink" title="第六章 买家订单"></a>第六章 买家订单</h1><p>DTO</p>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-073808.png" title="image-20190714153806377" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-073808.png" alt="image-20190714153806377" title class></a>
                <p>image-20190714153806377</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-073824.png" title="image-20190714153822552" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-073824.png" alt="image-20190714153822552" title class></a>
                <p>image-20190714153822552</p>
            </figure>

<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-073842.png" title="image-20190714153841368" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-073842.png" alt="image-20190714153841368" title class></a>
                <p>image-20190714153841368</p>
            </figure>

<hr>
<ul>
<li><p>异常处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResultEnum &#123;</span><br><span class="line">    PRODUCT_NOT_EXIST(<span class="number">10</span>, <span class="string">"商品不存在"</span>),</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    ResultEnum(Integer code, String message) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SellException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SellException</span><span class="params">(ResultEnum resultEnum)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(resultEnum.getMessage());</span><br><span class="line">            <span class="keyword">this</span>.code = resultEnum.getCode();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>Navigate 操作数据库要保存 手动保存</p>
<p>mysql AUTO_INCREMENT 设置主键自增</p>
<blockquote>
<p>  <code>detail_id</code> int(32) NOT NULL AUTO_INCREMENT,</p>
</blockquote>
<p>注意在navicat中表已经建立了 就无法使用</p>
<p>主键自增 Bug</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The database returned no natively generated identity value; nested exception is org.hibernate.HibernateException: The database returned no natively generated identity value</span><br></pre></td></tr></table></figure>

<p><a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-234330.png" title="image-20190715074328283" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-14-234330.png" alt="image-20190715074328283"></a></p>
</li>
</ul>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-15-014500.png" title="image-20190715094458370" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-15-014500.png" alt="image-20190715094458370" title class></a>
                <p>image-20190715094458370</p>
            </figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDTO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String orderId;</span><br><span class="line">    <span class="comment">//买家名字</span></span><br><span class="line">    <span class="keyword">private</span> String buyerName;</span><br><span class="line">    <span class="comment">//买家手机</span></span><br><span class="line">    <span class="keyword">private</span> String buyerPhone;</span><br><span class="line">    <span class="comment">//买家地址</span></span><br><span class="line">    <span class="keyword">private</span> String buyerAddress;</span><br><span class="line">    <span class="comment">//买家地址</span></span><br><span class="line">    <span class="keyword">private</span> String buyerOpenid;</span><br><span class="line">    <span class="comment">//订单总金额</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal orderAmount;</span><br><span class="line">    <span class="comment">//订单状态 默认为新下单</span></span><br><span class="line">    <span class="keyword">private</span> Integer orderStatus = OrderStatusEnum.NEW.getCode();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付状态 默认为0 未支付</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer payStatus = PayStatusEnum.WAIT.getCode();</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="keyword">private</span> List&lt;OrderDetail&gt; orderDetailList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImpl</span> <span class="keyword">implements</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderMasterRepostiory orderMasterRepostiory;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductServiceImpl productService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderDetailRepository orderDetailRepository;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    IdWorker idWorker;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderDTO <span class="title">create</span><span class="params">(OrderDTO orderDTO)</span> </span>&#123;</span><br><span class="line">        String orderId = idWorker.nextId() + <span class="string">""</span>;</span><br><span class="line">        <span class="comment">//1 拿到OrderDTO 存到ORDERmaster中</span></span><br><span class="line">        BigDecimal orderAmount = <span class="keyword">new</span> BigDecimal(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//先拿到productId</span></span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailList = orderDTO.getOrderDetailList();</span><br><span class="line">        <span class="keyword">for</span> (OrderDetail orderDetail : orderDetailList) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过productID查询商品的信息 拷贝到orderDetail表中 存起来</span></span><br><span class="line">            ProductInfo productInfo = productService.findById(orderDetail.getProductId());</span><br><span class="line">            BeanUtils.copyProperties(productInfo, orderDetail);</span><br><span class="line">            orderDetail.setDetailId(idWorker.nextId() + <span class="string">""</span>);</span><br><span class="line">            orderDetail.setOrderId(orderId);</span><br><span class="line">            orderDetailRepository.save(orderDetail);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过productID查询商品的的价格（从数据库中查）</span></span><br><span class="line">            BigDecimal productPrice = productInfo.getProductPrice();</span><br><span class="line">            <span class="comment">//通过orderDTO查询商品的购买数量</span></span><br><span class="line">            Integer productQuantity = orderDetail.getProductQuantity();</span><br><span class="line">            <span class="comment">//求出商品总价 存到orderMaster数据中</span></span><br><span class="line">            orderAmount = productPrice.multiply(<span class="keyword">new</span> BigDecimal(productQuantity)).add(orderAmount);</span><br><span class="line">            OrderMaster orderMaster = <span class="keyword">new</span> OrderMaster();</span><br><span class="line">            orderDTO.setOrderId(orderId);</span><br><span class="line">            <span class="comment">//先拷贝在设置值要不然为空</span></span><br><span class="line">            BeanUtils.copyProperties(orderDTO, orderMaster);</span><br><span class="line">            <span class="comment">//orderMaster.setOrderId("1314");  不应该是ordermaster设置orderId 因为传来的orderDTO 需要一个id</span></span><br><span class="line">            orderMaster.setOrderAmount(orderAmount);</span><br><span class="line">            orderMaster.setOrderStatus(OrderStatusEnum.NEW.getCode());</span><br><span class="line">            orderMaster.setPayStatus(PayStatusEnum.WAIT.getCode());</span><br><span class="line">            orderMasterRepostiory.save(orderMaster);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//减库存product_stock =catrDTO 传递一个catrDTOS</span></span><br><span class="line">        List&lt;CartDTO&gt; cartDTOList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailLists = orderDTO.getOrderDetailList();</span><br><span class="line">        <span class="keyword">for</span> (OrderDetail orderDetail : orderDetailLists) &#123;</span><br><span class="line">            String productId = orderDetail.getProductId();</span><br><span class="line">            Integer productQuantity = orderDetail.getProductQuantity();</span><br><span class="line">            CartDTO cartDTO = <span class="keyword">new</span> CartDTO();</span><br><span class="line">            cartDTO.setProductQuantity(productQuantity);</span><br><span class="line">            cartDTO.setProductId(productId);</span><br><span class="line">            cartDTOList.add(cartDTO);</span><br><span class="line">        &#125;</span><br><span class="line">        productService.decreaseStock(cartDTOList);</span><br><span class="line">        <span class="keyword">return</span> orderDTO;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartDTO</span> </span>&#123;</span><br><span class="line">    <span class="comment">//商品id</span></span><br><span class="line">    <span class="keyword">private</span> String productId;</span><br><span class="line">    <span class="comment">//商品数量</span></span><br><span class="line">    <span class="keyword">private</span> Integer ProductQuantity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CartDTO</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//减库存</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decreaseStock</span><span class="params">(List&lt;CartDTO&gt; cartDTOS)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (cartDTOS == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.PRODUCT_NOT_EXIST);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (CartDTO cartDTO : cartDTOS) &#123;</span><br><span class="line">          Optional&lt;ProductInfo&gt; productInfoOptional = productInfoRepository.findById(cartDTO.getProductId());</span><br><span class="line">          <span class="keyword">if</span> (productInfoOptional.isPresent()) &#123;</span><br><span class="line">              ProductInfo productInfo = productInfoOptional.get();</span><br><span class="line">              Integer productStock = productInfo.getProductStock();</span><br><span class="line">              <span class="comment">//新库存 newstock=数据库里面的库存-前端页面传来的商品数量</span></span><br><span class="line">              Integer newstock = productStock - cartDTO.getProductQuantity();</span><br><span class="line">              <span class="keyword">if</span> (newstock == <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.PRODUCT_STOCK_ERROR);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="comment">//更新库存 存到商品里面(不要新new了 直接放到原来的里面构造方法就是设置值)</span></span><br><span class="line">              <span class="comment">//   ProductInfo newproductInfo = new ProductInfo();</span></span><br><span class="line">              productInfo.setProductStock(newstock);</span><br><span class="line">              <span class="comment">//更新了整条数据</span></span><br><span class="line">              <span class="comment">// newproductInfo.setProductId(cartDTO.getProductId());</span></span><br><span class="line">              productInfoRepository.save(productInfo);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderServiceImplTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OrderServiceImpl orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">create</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        OrderDTO orderDTO = <span class="keyword">new</span> OrderDTO();</span><br><span class="line">        orderDTO.setBuyerPhone(<span class="string">"18868822111"</span>);</span><br><span class="line">        orderDTO.setBuyerName(<span class="string">"张三"</span>);</span><br><span class="line">        orderDTO.setBuyerOpenid(<span class="string">"ew3euwhd7sjw9diwkq"</span>);</span><br><span class="line">        orderDTO.setBuyerAddress(<span class="string">"慕课网总部"</span>);</span><br><span class="line">        List&lt;OrderDetail&gt; orderDetails = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        OrderDetail orderDetail = <span class="keyword">new</span> OrderDetail();</span><br><span class="line"><span class="comment">//        java.lang.IllegalArgumentException: Source must not be null</span></span><br><span class="line">        orderDetail.setProductId(<span class="string">"123457"</span>);</span><br><span class="line">        orderDetail.setProductQuantity(<span class="number">2</span>);  <span class="comment">//  2 //购买数量</span></span><br><span class="line">        orderDetails.add(orderDetail);</span><br><span class="line">        orderDTO.setOrderDetailList(orderDetails);</span><br><span class="line">        <span class="comment">//orderDTO.setOrderId("123");   orderDTO需要一个id</span></span><br><span class="line">        OrderDTO result = orderService.create(orderDTO);</span><br><span class="line">        log.info(<span class="string">"result:&#123;&#125;"</span>, result);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>查询订单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderDTO <span class="title">findOne</span><span class="params">(String orderId)</span> </span>&#123;</span><br><span class="line">        Optional&lt;OrderMaster&gt; orderMasterOptional = orderMasterRepostiory.findById(orderId);</span><br><span class="line">        <span class="keyword">if</span> (orderMasterOptional.isPresent()) &#123;</span><br><span class="line">            OrderMaster orderMaster = orderMasterOptional.get();</span><br><span class="line">            OrderDTO orderDTO = <span class="keyword">new</span> OrderDTO();</span><br><span class="line">            BeanUtils.copyProperties(orderMaster, orderDTO);</span><br><span class="line"><span class="comment">//            List&lt;OrderDetail&gt; orderDetailList = new ArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//            OrderDetail orderDetail = new OrderDetail();</span></span><br><span class="line">            List&lt;OrderDetail&gt; byOrderId = orderDetailRepository.findByOrderId(orderDTO.getOrderId());</span><br><span class="line"><span class="comment">//            orderDetailList.add(orderDetail);</span></span><br><span class="line">            orderDTO.setOrderDetailList(byOrderId);</span><br><span class="line">            <span class="keyword">return</span> orderDTO;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_NOT_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;OrderDTO&gt; <span class="title">findList</span><span class="params">(Pageable pageable, String bunerOpenid)</span> </span>&#123;</span><br><span class="line">      Page&lt;OrderMaster&gt; orderMasterPage = orderMasterRepostiory.findByBuyerOpenid(pageable, bunerOpenid);</span><br><span class="line">      List&lt;OrderDTO&gt; orderDTOList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">for</span> (OrderMaster orderMaster : orderMasterPage) &#123;</span><br><span class="line">          OrderDTO orderDTO = <span class="keyword">new</span> OrderDTO();</span><br><span class="line">          BeanUtils.copyProperties(orderMaster, orderDTO);</span><br><span class="line">          orderDTOList.add(orderDTO);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> orderDTOList;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//取消订单</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderDTO <span class="title">cancel</span><span class="params">(OrderDTO orderDTO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断订单状态   create的时候设置成 NEW (0,"新订单"）     FINSHED(1, "完结"),  CEL(2, "取消")</span></span><br><span class="line">        <span class="keyword">if</span> (!orderDTO.getOrderStatus().equals(OrderStatusEnum.NEW.getCode())) &#123;</span><br><span class="line">            log.error(<span class="string">"[取消订单] 订单状态不正确，orderId=&#123;&#125;,orderStatus=&#123;&#125;"</span>, orderDTO.getOrderId(), orderDTO.getOrderStatus());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_STATUS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//修改订单状态</span></span><br><span class="line">        OrderMaster orderMaster = <span class="keyword">new</span> OrderMaster();</span><br><span class="line">        BeanUtils.copyProperties(orderDTO, orderMaster);</span><br><span class="line">        orderMaster.setOrderStatus(OrderStatusEnum.CANCEL.getCode());</span><br><span class="line">        OrderMaster updateResult = orderMasterRepostiory.save(orderMaster);</span><br><span class="line">        <span class="keyword">if</span> (updateResult == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_UPDATE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回库存</span></span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(orderDTO.getOrderDetailList())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_DETAIL_EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;CartDTO&gt; cartDTOList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        CartDTO cartDTO = <span class="keyword">new</span> CartDTO();</span><br><span class="line">        List&lt;OrderDetail&gt; orderDetailList = orderDTO.getOrderDetailList();</span><br><span class="line">        <span class="keyword">for</span> (OrderDetail orderDetail : orderDetailList) &#123;</span><br><span class="line">            Integer productQuantity = orderDetail.getProductQuantity();</span><br><span class="line">            String productId = orderDetail.getProductId();</span><br><span class="line">            cartDTO.setProductId(productId);</span><br><span class="line">            cartDTO.setProductQuantity(productQuantity);</span><br><span class="line">            cartDTOList.add(cartDTO);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;CartDTO&gt; cartDTOList1 = cartDTOList;</span><br><span class="line">        productService.increaseStock(cartDTOList);</span><br><span class="line">        <span class="comment">//如果已经支付 需要退款</span></span><br><span class="line"><span class="comment">//        if (orderDTO.getPayStatus(PayStatusEnum.SUCCESS.getCode())) &#123;</span></span><br><span class="line"><span class="comment">//            //TODO</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> orderDTO;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加库存</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="meta">@Transactional</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increaseStock</span><span class="params">(List&lt;CartDTO&gt; cartDTOS)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">for</span> (CartDTO cartDTO : cartDTOS) &#123;</span><br><span class="line">         String productId = cartDTO.getProductId();</span><br><span class="line">         Integer productQuantity = cartDTO.getProductQuantity();</span><br><span class="line">         ProductInfo productInfo = productInfoRepository.getOne(productId);</span><br><span class="line">         <span class="keyword">if</span> (productInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.PRODUCT_NOT_EXIST);</span><br><span class="line">         &#125;</span><br><span class="line">         Integer productStock = productInfo.getProductStock();</span><br><span class="line">         Integer newProductStock = productStock + productQuantity;</span><br><span class="line">         productInfo.setProductStock(newProductStock);</span><br><span class="line">         productInfoRepository.save(productInfo);</span><br><span class="line"></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分析 OrderDTO 里面有orderdetailList</span></span><br><span class="line"><span class="comment">     *  ordertailList里面有orderid  productid 可以实现多表查询 不要用主外键盘 和多表查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    OrderDTO orderDTO = orderService.findOne(<span class="string">"1150598982927486976"</span>);</span><br><span class="line">    OrderDTO cancel = orderService.cancel(orderDTO);</span><br><span class="line">    System.out.println(cancel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderDTO <span class="title">paid</span><span class="params">(OrderDTO orderDTO)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断订单状态   create的时候设置成 NEW (0,"新订单"）     FINSHED(1, "完结"),  CEL(2, "取消")</span></span><br><span class="line">        <span class="keyword">if</span> (!orderDTO.getOrderStatus().equals(OrderStatusEnum.NEW.getCode())) &#123;</span><br><span class="line">            log.error(<span class="string">"[取消订单] 订单状态不正确，orderId=&#123;&#125;,orderStatus=&#123;&#125;"</span>, orderDTO.getOrderId(), orderDTO.getOrderStatus());</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_STATUS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断支付状态 一开始create订单的时候设置的是WAIT 待支付</span></span><br><span class="line">        <span class="keyword">if</span> (!orderDTO.getOrderStatus().equals(PayStatusEnum.WAIT.getCode())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_PAY_STATUS_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//修改支付状态</span></span><br><span class="line">        OrderDTO payorderDTO = <span class="keyword">new</span> OrderDTO();</span><br><span class="line">        OrderMaster orderMaster = <span class="keyword">new</span> OrderMaster();</span><br><span class="line">        BeanUtils.copyProperties(payorderDTO, orderMaster);</span><br><span class="line">        orderMaster.setPayStatus(PayStatusEnum.SUCCESS.getCode());</span><br><span class="line">        OrderMaster save = orderMasterRepostiory.save(orderMaster);</span><br><span class="line">        <span class="keyword">if</span> (save == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_UPDATE_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> orderDTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>GSON</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">JSON作为一个轻量级的数据格式比xml效率要高，XML需要很多的标签，这无疑占据了网络流量。</span><br><span class="line"></span><br><span class="line">1、JSON可以有两种格式</span><br><span class="line"></span><br><span class="line">一种是对象格式的：</span><br><span class="line"></span><br><span class="line">&#123;&quot;name&quot;:&quot;JSON&quot;,&quot;address&quot;:&quot;北京市西城区&quot;,&quot;age&quot;:25&#125;//JSON的对象格式的字符串</span><br><span class="line">另一种是数组对象</span><br><span class="line"></span><br><span class="line">[&#123;&quot;name&quot;:&quot;JSON&quot;,&quot;address&quot;:&quot;北京市西城区&quot;,&quot;age&quot;:25&#125;]//数据对象格式</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">从上面的两种格式可以看出对象格式和数组对象格式唯一的不同则是在对象格式的基础上加上了[]，再来看具体的结构，可以看出都是以键值对的形式出现的，中间以英文状态下的逗号（,）分隔。</span><br><span class="line"></span><br><span class="line">在前端和后端进行数据传输的时候这种格式也是很受欢迎的，后端返回json格式的字符串，前台使用js中的JSON.parse()方法把JSON字符串解析为json对象，然后进行遍历，供前端使用。</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BuyerOrderController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderServiceImpl orderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/create"</span>)</span><br><span class="line">    <span class="keyword">public</span> ResultVo&lt;Map&lt;String, String&gt;&gt; create(<span class="meta">@Valid</span> OrderForm orderForm, BindingResult bindingResult) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bindingResult.hasErrors()) &#123;</span><br><span class="line">            String defaultMessage = bindingResult.getFieldError().getDefaultMessage();</span><br><span class="line">            log.error(<span class="string">"创建订单参数不正确"</span> + defaultMessage);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.FORM_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        OrderDTO orderDTO = <span class="keyword">new</span> OrderDTO();</span><br><span class="line">        <span class="comment">//属性的值不一样不能转啊(不可以用 BeanUtils.copyProperties)</span></span><br><span class="line">        <span class="comment">//BeanUtils.copyProperties(orderForm, orderDTO);</span></span><br><span class="line">        String name = orderForm.getName();</span><br><span class="line">        String address = orderForm.getAddress();</span><br><span class="line">        String openid = orderForm.getOpenid();</span><br><span class="line">        String items = orderForm.getItems();</span><br><span class="line">        String phone = orderForm.getPhone();</span><br><span class="line">        orderDTO.setBuyerName(name);</span><br><span class="line">        orderDTO.setBuyerPhone(phone);</span><br><span class="line">        orderDTO.setBuyerOpenid(openid);</span><br><span class="line">        orderDTO.setBuyerAddress(address);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * items: [&#123;  cartDO</span></span><br><span class="line"><span class="comment">         *     productId: "1423113435324",</span></span><br><span class="line"><span class="comment">         *     productQuantity: 2 //购买数量</span></span><br><span class="line"><span class="comment">         * &#125;]</span></span><br><span class="line"><span class="comment">         * OrderDetail:</span></span><br><span class="line"><span class="comment">         *         [&#123;</span></span><br><span class="line"><span class="comment">         productId: "1423113435324",</span></span><br><span class="line"><span class="comment">         productQuantity: 2 //购买数量</span></span><br><span class="line"><span class="comment">         &#125;]</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//解析JSON 集合形式</span></span><br><span class="line">        <span class="comment">//new Gson().fromJson(jsonArray, new TypeToken&lt;List&lt;Object&gt;&gt;()&#123;&#125;.getType());</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * List&lt;Person&gt; ps = gson.fromJson(str, new TypeToken&lt;List&lt;Person&gt;&gt;()&#123;&#125;.getType())</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Gson gson = <span class="keyword">new</span> Gson();</span><br><span class="line">        String jsonString = items;</span><br><span class="line">        List&lt;OrderDetail&gt; orderDetails = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            orderDetails = gson.fromJson(jsonString, <span class="keyword">new</span> TypeToken&lt;List&lt;OrderDetail&gt;&gt;() &#123;</span><br><span class="line">            &#125;.getType());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonSyntaxException e) &#123;</span><br><span class="line">            log.error(<span class="string">"购物车对象转换错误 items=&#123;&#125;"</span>, orderForm.getItems());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            orderDTO.setOrderDetailList(orderDetails);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(orderDTO.getOrderDetailList())) &#123;</span><br><span class="line">            log.error(<span class="string">"[购物车为空】"</span>);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.CART_EMPTY);</span><br><span class="line">        &#125;</span><br><span class="line">        OrderDTO orderDTOcreate = orderService.create(orderDTO);</span><br><span class="line">        String orderId = orderDTOcreate.getOrderId();</span><br><span class="line">        log.error(orderId);</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"orderIds "</span>, orderId);</span><br><span class="line">        ResultVo resultVo = ResultVoUtil.success(map);</span><br><span class="line">        <span class="keyword">return</span> resultVo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;OrderDTO&gt; <span class="title">findList</span><span class="params">(Pageable pageable, String openId)</span> </span>&#123;</span><br><span class="line">        Page&lt;OrderMaster&gt; orderMasterPage = orderMasterRepostiory.findByBuyerOpenid(pageable, openId);</span><br><span class="line">        <span class="comment">//取出Page里面的内容</span></span><br><span class="line">        List&lt;OrderMaster&gt; content = orderMasterPage.getContent();</span><br><span class="line">        List&lt;OrderDTO&gt; orderDTOList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (OrderMaster orderMaster : content) &#123; <span class="comment">//遍历的是Content而不是orderMasterPage</span></span><br><span class="line">            OrderDTO orderDTO = <span class="keyword">new</span> OrderDTO();</span><br><span class="line">            BeanUtils.copyProperties(orderMaster, orderDTO);</span><br><span class="line">            orderDTOList.add(orderDTO);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> totalPages = orderMasterPage.getTotalPages();</span><br><span class="line">        <span class="keyword">long</span> totalElements = orderMasterPage.getTotalElements();</span><br><span class="line">        log.error(<span class="string">"totalPages&#123;&#125;,totalElements&#123;&#125;"</span>, totalPages, totalElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PageImpl&lt;OrderDTO&gt;(orderDTOList, pageable, orderMasterPage.getTotalElements());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询订单列表</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> ResultVo <span class="title">list</span><span class="params">(@RequestParam(<span class="string">"openId"</span>)</span> String openId, @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"page"</span>, defaultValue = <span class="string">"2"</span>)</span> Integer page, @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"size"</span>, defaultValue = <span class="string">"10"</span>)</span> Integer size) </span>&#123;</span><br><span class="line">      <span class="comment">//Pageable pageable, String bunerOpenid</span></span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isEmpty(openId)) &#123;</span><br><span class="line">          log.error(<span class="string">"openId----null"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      PageRequest of = PageRequest.of(page - <span class="number">1</span>, size);</span><br><span class="line">      Page&lt;OrderDTO&gt; list = orderService.findList(of, openId);</span><br><span class="line">      List&lt;OrderDTO&gt; content = list.getContent();</span><br><span class="line">      <span class="keyword">return</span> ResultVoUtil.success(content)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/detail"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ResultVo <span class="title">detail</span><span class="params">(@RequestParam(<span class="string">"openId"</span>)</span> String openId, @<span class="title">RequestParam</span><span class="params">(<span class="string">"orderId"</span>)</span> String orderId) </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO OpenID</span></span><br><span class="line">    OrderDTO orderDTO = orderService.findOne(orderId);</span><br><span class="line">    <span class="keyword">return</span> ResultVoUtil.success(orderDTO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//查询订单详情</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/detail"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVo <span class="title">detail</span><span class="params">(@RequestParam(<span class="string">"openId"</span>)</span> String openId, @<span class="title">RequestParam</span><span class="params">(<span class="string">"orderId"</span>)</span> String orderId) </span>&#123;</span><br><span class="line"></span><br><span class="line">        OrderDTO orderDTO = orderService.findOne(orderId);</span><br><span class="line">        <span class="keyword">if</span> (orderDTO == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!orderDTO.getBuyerOpenid().equalsIgnoreCase(openId)) &#123;</span><br><span class="line">            log.error(<span class="string">"查询订单失败openId=&#123;&#125;,orderDTO=&#123;&#125;"</span>, openId, orderDTO);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_OWNER_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResultVoUtil.success(orderDTO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取消订单</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/cancel"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVo <span class="title">cancel</span><span class="params">(@RequestParam(<span class="string">"openId"</span>)</span> String openId, @<span class="title">RequestParam</span><span class="params">(<span class="string">"orderId"</span>)</span> String orderId) </span>&#123;</span><br><span class="line">        OrderDTO orderDTO = orderService.findOne(orderId);</span><br><span class="line">        OrderDTO cancel = orderService.cancel(orderDTO);</span><br><span class="line">        <span class="keyword">if</span> (cancel == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!orderDTO.getBuyerOpenid().equalsIgnoreCase(openId)) &#123;</span><br><span class="line">            log.error(<span class="string">"取消订单失败查不到该订单openId=&#123;&#125;,orderDTO=&#123;&#125;"</span>, openId, orderDTO);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SellException(ResultEnum.ORDER_OWNER_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResultVoUtil.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="第七章-微信"><a href="#第七章-微信" class="headerlink" title="第七章 微信"></a>第七章 微信</h1><h3 id="1-手工-方式-JSAPI-支付"><a href="#1-手工-方式-JSAPI-支付" class="headerlink" title="1 手工 方式(JSAPI)支付"></a>1 手工 方式(JSAPI)支付</h3><figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-16-231926.png" title="image-20190717071920268" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-16-231926.png" alt="image-20190717071920268" title class></a>
                <p>image-20190717071920268</p>
            </figure>

<blockquote>
<p><a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=4_4" target="_blank" rel="noopener">https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=4_4</a></p>
</blockquote>
<hr>
<h4 id="natapp"><a href="#natapp" class="headerlink" title="natapp"></a>natapp</h4><figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-002814.png" title="image-20190717082812135" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-002814.png" alt="image-20190717082812135" title class></a>
                <p>image-20190717082812135</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-2845.png" title="image-20190717082842533" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-2845.png" alt="image-20190717082842533" title class></a>
                <p>image-20190717082842533</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-002934.png" title="image-20190717082928962" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-002934.png" alt="image-20190717082928962" title class></a>
                <p>image-20190717082928962</p>
            </figure>

<p>该网址  <a href="http://ywy9n8.natappfree.cc" target="_blank" rel="noopener">http://ywy9n8.natappfree.cc</a>  就是可以全球访问的网址,可以发给您的小伙伴试试 :)</p>
<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-003946.png" title="image-20190717083944900" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-003946.png" alt="image-20190717083944900" title class></a>
                <p>image-20190717083944900</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="../../../../Library/Application" title="Support/typora-user-images/image-20190717084011877.png" data-fancybox="images"><img src="../../../../Library/Application" alt="image-20190717084011877" title="Support/typora-user-images/image-20190717084011877.png" class></a>
                <p>Support/typora-user-images/image-20190717084011877.png</p>
            </figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.github.binarywang&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;weixin-java-mp&lt;/artifactId&gt;</span><br><span class="line">          &lt;version&gt;3.4.0&lt;/version&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://github.com/Wechat-Group/WxJava" target="_blank" rel="noopener">https://github.com/Wechat-Group/WxJava</a></p>
</blockquote>
<hr>
<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-010811.png" title="image-20190717090809065" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-010811.png" alt="image-20190717090809065" title class></a>
                <p>image-20190717090809065</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-033015.png" title="image-20190717113013573" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-033015.png" alt="image-20190717113013573" title class></a>
                <p>image-20190717113013573</p>
            </figure>

<figure class="image-box">
                <a rel=微信点餐系统 href="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-041947.png" title="image-20190717121945289" data-fancybox="images"><img src="http://ipic-freemana-1257703707.cos.ap-shanghai.myqcloud.com/2019-07-17-041947.png" alt="image-20190717121945289" title class></a>
                <p>image-20190717121945289</p>
            </figure>
        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-07-17T04:19:54.052Z" itemprop="dateUpdated">2019-07-17 12:19:54</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/07/11/项目实战/2019-07-11-慕课网微信点餐系统.md/" target="_blank" rel="external">http://yoursite.com/2019/07/11/项目实战/2019-07-11-慕课网微信点餐系统.md/</a>
        
    </div>
    <footer>
        <a href="http://yoursite.com">
            <img src="/img/avatar.jpg" alt="John Doe">
            John Doe
        </a>
    </footer>
</blockquote>

        
            <div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>

            
        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/">SpringBoot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/项目/">项目</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2019/07/11/项目实战/2019-07-11-慕课网微信点餐系统.md/&title=《微信点餐系统》 — Hexo&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2019/07/11/项目实战/2019-07-11-慕课网微信点餐系统.md/&title=《微信点餐系统》 — Hexo&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/07/18/模版技术/Freemarker/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Freemarker</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/06/26/ELasticseach/ElSearch慕课网搜房网/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Elasticsearch 搜房网 慕课网</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一-表结构"><span class="post-toc-number">1.</span> <span class="post-toc-text">一 表结构</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二-VM"><span class="post-toc-number">2.</span> <span class="post-toc-text">二 VM</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三-日志"><span class="post-toc-number">3.</span> <span class="post-toc-text">三 日志</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#第五章-买家商品"><span class="post-toc-number">4.</span> <span class="post-toc-text">第五章 买家商品</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#第六章-买家订单"><span class="post-toc-number">5.</span> <span class="post-toc-text">第六章 买家订单</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#第七章-微信"><span class="post-toc-number">6.</span> <span class="post-toc-text">第七章 微信</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-手工-方式-JSAPI-支付"><span class="post-toc-number">6.0.1.</span> <span class="post-toc-text">1 手工 方式(JSAPI)支付</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#natapp"><span class="post-toc-number">6.0.1.1.</span> <span class="post-toc-text">natapp</span></a></li></ol></li></ol></li></ol></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>

    <div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        我们一起来让这个世界有趣一点
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/reward-wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/reward-wechat.jpg" data-alipay="/img/reward-alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>

    

</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://www.lujingtao.com" target="_blank">HOME</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                John Doe &copy; 2017 - 2019
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2019/07/11/项目实战/2019-07-11-慕课网微信点餐系统.md/&title=《微信点餐系统》 — Hexo&pic=http://yoursite.com/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2019/07/11/项目实战/2019-07-11-慕课网微信点餐系统.md/&title=《微信点餐系统》 — Hexo&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADIElEQVR42u3awW7iQBAE0Pz/T2evK2UxVT1GC53nU0QgnmeklKZ6vr7i6/uva/bK9Tsf3evne/K/c8OFjY2N/SHs78srX0r++k9Asp5Hn7pe58M1YGNjY69jXy+rfU9y4zyikiTK14mNjY2N3S4oX1Z7YWNjY2OfhNP1X2g3DLNAah8rNjY29m72XSExK/STLc1/69KwsbGx356dT0Xf/+eXzLexsbGx35g9K3HaAz0nfy0Pv0KBjY2NvYh9b9E/Gwy3x3pm2wxsbGzsrexZDXQyiL3roM/sS8LGxsbex56NZu8q+vMYy4MwGVdgY2Nj72Png9t8BJvH0uzn9rBOfVIJGxsb+0PYd20e2lBMBgAntVGU1djY2Ngr2LORbVv6n0RUMeUoiydsbGzsHey7xquz7cHrIu3JfbGxsbEXsdt6aPb//+S3s3FC9LCwsbGxV7BnkXNe6+Q1VhJsedWFjY2N/dvYSfpdU4/mzwF+2KJhY2NjL2K3xU1bJ50czWkfa73hwcbGxl7BPgmeWSzNBsZ31UzR4rCxsbE/kJ0v6/y4z6w8auPqySPDxsbGXseeFUaviLd2wzO8sLGxsRex2yHu+SA2H0XMxgN5uGJjY2NvZedVTlv6nx/laTctT+6IjY2NvYLdbjDacUKLzOuhdq/xpEvDxsbGXsRuNwP5g2s/lR/TyddfDHqxsbGxP4o9i4fZ4CF/rO3woAhIbGxs7NXs2TD4FRV/W0XVgwFsbGzsRewZb3a8pn1M7UDi+r7/KJWwsbGxP5w9G7Welzsz6vXd2y8AGxsbexM7r3Xa5bZjg9ln843Kw30YNjY29iL2LGzasr4d4ibR1fZF2NjY2FvZdwXSefi1r9erxcbGxl7B/i6vtpSfzVXbr6EeDGBjY2MvYrf/+tstx0nI5duVfFNU47GxsbE/hH0SWie1TnKvvPTPHzc2Njb2VnZeys+OziTRdcOZozxKsbGxsX8x+95h8ElhNFstNjY2NnZeCbUblddNs7GxsbF/A7sNpPPAa4/y5FEXrQobGxt7EbsNg7YGase9s6qoXSE2Njb2CvYfzFbEcO9Uj+AAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.3"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.3"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.3"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.3"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.3"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>







    
</body>
</html>
